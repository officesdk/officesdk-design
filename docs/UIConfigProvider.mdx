import { Meta } from '@storybook/blocks';

<Meta title="Documentation/UIConfigProvider" />

# UIConfigProvider

## Overview

`UIConfigProvider` is the unified configuration provider for all UI components. It integrates ThemeProvider, IconProvider, ToastContainer, and other global configurations into a single, easy-to-use component.

## Why UIConfigProvider?

### Before (Multiple Providers)

```tsx
import { ThemeProvider } from 'styled-components';
import { IconProvider, ToastContainer } from '@officesdk/design';
import { lightTheme } from '@officesdk/design/theme';
import { iconRegistry } from '@officesdk/design/icons';

<ThemeProvider theme={lightTheme}>
  <IconProvider icons={iconRegistry}>
    <ToastContainer defaultDuration={3000} maxCount={5}>
      <App />
    </ToastContainer>
  </IconProvider>
</ThemeProvider>
```

### After (Single Provider)

```tsx
import { UIConfigProvider, createUIConfig } from '@officesdk/design';
import { lightTheme } from '@officesdk/design/theme';
import { iconRegistry } from '@officesdk/design/icons';

const config = createUIConfig({
  theme: lightTheme,
  icons: iconRegistry,
  toast: {
    defaultDuration: 3000,
    maxCount: 5,
  },
});

<UIConfigProvider config={config}>
  <App />
</UIConfigProvider>
```

## Basic Usage

### Using UIConfigProvider (React Component)

```tsx
import { UIConfigProvider, createUIConfig } from '@officesdk/design';
import { lightTheme } from '@officesdk/design/theme';

const config = createUIConfig({
  theme: lightTheme,
});

function App() {
  return (
    <UIConfigProvider config={config}>
      {/* Your app components */}
    </UIConfigProvider>
  );
}
```

### Using initUIConfig (Non-React / Global Configuration)

For scenarios where you want to avoid React Provider nesting or configure before React app starts:

```tsx
import { initUIConfig } from '@officesdk/design';
import { lightTheme } from '@officesdk/design/theme';
import { iconRegistry } from '@officesdk/design/icons';

// Initialize before React app starts (e.g., in index.tsx or main.tsx)
initUIConfig({
  theme: lightTheme,
  icons: iconRegistry,
  toast: {
    maxCount: 5,
    defaultDuration: 3000,
  },
});

// Now you can use components without UIConfigProvider
function App() {
  return <Button>Click me</Button>;
}
```

**Benefits of `initUIConfig`:**
- ✅ No React Provider dependency - works in non-React environments
- ✅ Avoid Provider nesting - useful for Modal/Portal scenarios
- ✅ Global styles injected on-demand - only when components are first used
- ✅ Can be called before React app starts

**When to use `initUIConfig` vs `UIConfigProvider`:**
- Use `initUIConfig` when:
  - You want to avoid Provider nesting (e.g., Modal components)
  - You need to configure before React app starts
  - You're in a non-React environment
- Use `UIConfigProvider` when:
  - You prefer React Context pattern
  - You need per-component-tree configuration
  - You want to switch configurations dynamically

## Configuration Options

### Theme (Required)

```tsx
const config = createUIConfig({
  theme: lightTheme, // or darkTheme, or custom theme
});
```

### Icons (Optional)

```tsx
import { iconRegistry } from '@officesdk/design/icons';

const config = createUIConfig({
  theme: lightTheme,
  icons: iconRegistry, // Enable icon registry
});
```

### Toast Configuration

```tsx
const config = createUIConfig({
  theme: lightTheme,
  toast: {
    defaultDuration: 3000,  // Auto-close after 3s
    maxCount: 5,            // Max 5 toasts at once
    position: 'top-right',  // Toast position
    offset: {
      x: 24,                // Offset from edge
      y: 24,
    },
  },
});
```

### Internationalization

```tsx
const config = createUIConfig({
  theme: lightTheme,
  locale: 'en-US',
  i18n: {
    toast: {
      closeLabel: 'Close',
    },
    button: {
      loadingText: 'Loading...',
    },
    common: {
      confirm: 'Confirm',
      cancel: 'Cancel',
      ok: 'OK',
    },
  },
});
```

### Z-Index Management

```tsx
const config = createUIConfig({
  theme: lightTheme,
  zIndex: {
    toast: 9999,
    modal: 10000,
    dropdown: 1000,
    tooltip: 1001,
  },
});
```

### Animation Configuration

```tsx
const config = createUIConfig({
  theme: lightTheme,
  animation: {
    duration: 200,
    easing: 'cubic-bezier(0.4, 0, 0.2, 1)',
    disabled: false, // Set to true to disable all animations
  },
});
```

### Accessibility Configuration

```tsx
const config = createUIConfig({
  theme: lightTheme,
  a11y: {
    announceMessages: true,
    focusVisible: true,
    reduceMotion: false,
  },
});
```

## Using Configuration in Components

### useUIConfig Hook

```tsx
import { useUIConfig } from '@officesdk/design';

function MyComponent() {
  const config = useUIConfig();

  console.log(config.locale);              // 'zh-CN'
  console.log(config.toast.defaultDuration); // 3000
  console.log(config.animation.duration);  // 200

  return <div>...</div>;
}
```

### useToast Hook

```tsx
import { useToast } from '@officesdk/design';

function MyComponent() {
  const toast = useToast();

  const handleSuccess = () => {
    toast.success('Operation successful!');
  };

  const handleError = () => {
    toast.error('Operation failed');
  };

  return (
    <>
      <button onClick={handleSuccess}>Success</button>
      <button onClick={handleError}>Error</button>
    </>
  );
}
```

## Advanced Usage

### Modal / Portal Scenarios

When using components inside Modals or Portals, you don't need to nest `UIConfigProvider`:

```tsx
import { initUIConfig } from '@officesdk/design';
import { lightTheme } from '@officesdk/design/theme';

// Initialize once at app startup
initUIConfig({
  theme: lightTheme,
  icons: iconRegistry,
});

function Modal({ children }) {
  return (
    <Portal>
      {/* Components automatically use global config - no Provider needed */}
      {children}
    </Portal>
  );
}
```

### Merging Configurations

```tsx
import { createUIConfig, mergeUIConfig } from '@officesdk/design';
import { lightTheme } from '@officesdk/design/theme';

const baseConfig = createUIConfig({
  theme: lightTheme,
  toast: { defaultDuration: 3000 },
});

const customConfig = mergeUIConfig(baseConfig, {
  toast: { maxCount: 10 }, // Override maxCount
  locale: 'en-US',         // Add locale
});

<UIConfigProvider config={customConfig}>
  <App />
</UIConfigProvider>
```

### Multiple Configurations (Theme Switching)

```tsx
import { useState } from 'react';
import { UIConfigProvider, createUIConfig } from '@officesdk/design';
import { lightTheme, darkTheme } from '@officesdk/design/theme';

function App() {
  const [isDark, setIsDark] = useState(false);

  const config = createUIConfig({
    theme: isDark ? darkTheme : lightTheme,
    icons: iconRegistry,
  });

  return (
    <UIConfigProvider config={config}>
      <button onClick={() => setIsDark(!isDark)}>
        Toggle Theme
      </button>
      {/* Your app */}
    </UIConfigProvider>
  );
}
```

## Benefits

1. **Simplified Setup** - One provider instead of multiple
2. **Centralized Configuration** - All settings in one place
3. **Type Safety** - Full TypeScript support
4. **Default Values** - Sensible defaults for all options
5. **Easy to Extend** - Add new global configurations easily
6. **Backward Compatible** - Individual providers still available

## Migration Guide

### From ThemeProvider

**Before:**
```tsx
<ThemeProvider theme={lightTheme}>
  <App />
</ThemeProvider>
```

**After:**
```tsx
<UIConfigProvider config={{ theme: lightTheme }}>
  <App />
</UIConfigProvider>
```

### From Multiple Providers

**Before:**
```tsx
<ThemeProvider theme={lightTheme}>
  <IconProvider icons={iconRegistry}>
    <ToastContainer defaultDuration={3000}>
      <App />
    </ToastContainer>
  </IconProvider>
</ThemeProvider>
```

**After:**
```tsx
const config = createUIConfig({
  theme: lightTheme,
  icons: iconRegistry,
  toast: { defaultDuration: 3000 },
});

<UIConfigProvider config={config}>
  <App />
</UIConfigProvider>
```

